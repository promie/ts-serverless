service: notification-service
frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs18.x
  stage: ${opt:stage, 'dev'}
  region: ap-southeast-2
  iamRoleStatements:
    - Effect: Allow
      Action:
        - ses:SendEmail
      Resource: "arn:aws:ses:*"

resources:
  Resources:
    MailQueue:
      Type: AWS::SQS::Queue
      Properties:
        QueueName: ${self:custom.mailQueue.name}

functions:
  sendMail:
    handler: handler.sendMail
    events:
      - sqs:
          arn:
            Fn::GetAtt:
              - MailQueue
              - Arn
          batchSize: 1

plugins:
  - serverless-esbuild

custom:
  mailQueue:
    name: MailQueue-${self:provider.stage}
